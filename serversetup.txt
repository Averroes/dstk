Start with AMI # ami-da0cf8b3 (Ubuntu 10.04)

sudo aptitude update
sudo aptitude safe-upgrade -y
sudo aptitude full-upgrade -y
sudo aptitude install -y build-essential apache2 apache2.2-common apache2-mpm-prefork apache2-utils libexpat1 ssl-cert postgresql libpq-dev ruby1.8-dev ruby1.8 ri1.8 rdoc1.8 irb1.8 libreadline-ruby1.8 libruby1.8 libopenssl-ruby sqlite3 libsqlite3-ruby1.8 git-core libcurl4-openssl-dev apache2-prefork-dev libapr1-dev libaprutil1-dev

sudo sed -i "s/ident/trust/" /etc/postgresql/8.4/main/pg_hba.conf
sudo sed -i "s/md5/trust/" /etc/postgresql/8.4/main/pg_hba.conf
sudo /etc/init.d/postgresql-8.4 restart
createdb -U postgres geodict

sudo ln -s /usr/bin/ruby1.8 /usr/bin/ruby
sudo ln -s /usr/bin/ri1.8 /usr/bin/ri
sudo ln -s /usr/bin/rdoc1.8 /usr/bin/rdoc
sudo ln -s /usr/bin/irb1.8 /usr/bin/irb
mkdir ~/sources
cd ~/sources
wget http://rubyforge.org/frs/download.php/74388/rubygems-1.6.1.tgz
tar xzvf rubygems-1.6.1.tgz
cd rubygems-1.6.1/
sudo ruby setup.rb
sudo ln -s /usr/bin/gem1.8 /usr/bin/gem
sudo gem update --system
sudo gem update

cd ~/sources
git clone git://github.com/petewarden/geodictapi.git
git clone git://github.com/petewarden/geodictdata.git
cd geodictapi
sudo gem install bundler
sudo bundle install

sudo gem install passenger
sudo passenger-install-apache2-module

sudo bash -c 'echo "LoadModule passenger_module /usr/lib/ruby/gems/1.8/gems/passenger-3.0.4/ext/apache2/mod_passenger.so" > /etc/apache2/mods-enabled/passenger.load'
sudo bash -c 'echo "PassengerRoot /usr/lib/ruby/gems/1.8/gems/passenger-3.0.4" > /etc/apache2/mods-enabled/passenger.conf'
sudo bash -c 'echo "PassengerRuby /usr/bin/ruby1.8" >> /etc/apache2/mods-enabled/passenger.conf'

sudo bash -c 'echo "
  <VirtualHost *:80>
      ServerName www.yourhost.com
      DocumentRoot /home/ubuntu/sources/geodictapi/public
      <Directory /home/ubuntu/sources/geodictapi/public>
         AllowOverride all
         Options -MultiViews
      </Directory>
   </VirtualHost>
" > /etc/apache2/sites-enabled/000-default'

sudo /etc/init.d/apache2 restart

./populate_database.rb

// End of version 1.00

cd ~/sources
mkdir maxmind
cd maxmind
curl -O "http://geolite.maxmind.com/download/geoip/database/GeoLiteCity.dat.gz"
gunzip GeoLiteCity.dat.gz
curl -O "http://geolite.maxmind.com/download/geoip/api/c/GeoIP.tar.gz"
tar xzvf GeoIP.tar.gz
cd GeoIP-1.4.6/
./configure
make
sudo make install
cd ..
sudo aptitude install subversion -y
svn checkout svn://rubyforge.org/var/svn/net-geoip/trunk net-geoip
cd net-geoip/
ruby ext/extconf.rb 
make
sudo make install
